"use strict";(self["webpackChunkweek7_homework"]=self["webpackChunkweek7_homework"]||[]).push([[869],{8869:function(t,e,a){a.r(e),a.d(e,{default:function(){return Ct}});var l=a(3396),s=a(7139),d=a(9242);const i=(0,l._)("h2",null,"購物車",-1),o={class:"table align-middle"},r=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",null,"圖片"),(0,l._)("th",null,"商品名稱"),(0,l._)("th",null,"價格"),(0,l._)("th")])],-1),n={style:{width:"200px"}},c={key:0,class:"h5"},u={key:1},m={class:"h6"},p={class:"h5"},h={class:"btn-group btn-group-sm"},b=["onClick","disabled"],g=["onClick","disabled"],_={class:"fas fa-spinner fa-pulse"},v=(0,l.Uk)(" 加到購物車 "),f={class:"text-end",id:"bill"},y=["disabled"],w={class:"table align-middle"},k=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th"),(0,l._)("th",null,"品名"),(0,l._)("th",{style:{width:"150px"}},"數量/單位"),(0,l._)("th",null,"單價")])],-1),C=["onClick","disabled"],x={class:"fas fa-spinner fa-pulse"},I=(0,l.Uk)(" x "),L={class:"input-group input-group-sm"},D={class:"input-group mb-3"},z=["onUpdate:modelValue","onChange","disabled"],q=["value"],V={class:"input-group-text",id:"basic-addon2"},M={class:"text-end"},$=(0,l._)("td",{colspan:"3",class:"text-end"},"總計",-1),U={class:"text-end"},W={class:"container"},O={class:"row justify-content-center"},P={class:"mb-3"},Z=(0,l._)("label",{for:"email",class:"form-label"},"Email",-1),T={class:"mb-3"},F=(0,l._)("label",{for:"name",class:"form-label"},"收件人姓名",-1),E={class:"mb-3"},H=(0,l._)("label",{for:"tel",class:"form-label"},"收件人電話",-1),Y={class:"mb-3"},j=(0,l._)("label",{for:"address",class:"form-label"},"收件人地址",-1),K={class:"mb-3"},S=(0,l._)("label",{for:"message",class:"form-label"},"留言",-1),A={class:"text-end"},B=["disabled"];function G(t,e,a,G,J,N){const Q=(0,l.up)("Field"),R=(0,l.up)("ErrorMessage"),X=(0,l.up)("Form"),tt=(0,l.up)("ProductModal");return(0,l.wg)(),(0,l.iD)(l.HY,null,[i,(0,l._)("table",o,[r,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(J.products,(t=>((0,l.wg)(),(0,l.iD)("tr",{key:t.id},[(0,l._)("td",n,[(0,l._)("div",{style:(0,s.j5)([{backgroundImage:`url(${t.imageUrl})`},{height:"100px","background-size":"cover","background-position":"center"}])},null,4)]),(0,l._)("td",null,(0,s.zw)(t.title),1),(0,l._)("td",null,[t.price===t.origin_price?((0,l.wg)(),(0,l.iD)("div",c,(0,s.zw)(t.price)+" 元 ",1)):((0,l.wg)(),(0,l.iD)("div",u,[(0,l._)("del",m,"原價 "+(0,s.zw)(t.origin_price)+" 元",1),(0,l._)("div",p,"現在只要 "+(0,s.zw)(t.price)+" 元",1)]))]),(0,l._)("td",null,[(0,l._)("div",h,[(0,l._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e=>N.openProductModal(t.id),disabled:-1<J.isLoadingItem.indexOf(t.id)}," 查看更多 ",8,b),(0,l._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>N.addToCart(t.id),disabled:-1<J.isLoadingItem.indexOf(t.id)},[(0,l.wy)((0,l._)("i",_,null,512),[[d.F8,-1<J.isLoadingItem.indexOf(t.id)]]),v],8,g)])])])))),128))])]),(0,l._)("div",f,[(0,l._)("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...t)=>N.clearCart&&N.clearCart(...t)),disabled:0<J.isLoadingItem.length||0>=J.cartData.carts?.length}," 清空購物車 ",8,y)]),(0,l._)("table",w,[k,(0,l._)("tbody",null,[J.cartData.carts?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(J.cartData.carts,(e=>((0,l.wg)(),(0,l.iD)("tr",{key:e.id},[(0,l._)("td",null,[(0,l._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:t=>N.removeCartItem(e.id),disabled:-1<J.isLoadingItem.indexOf(e.id)},[(0,l.wy)((0,l._)("i",x,null,512),[[d.F8,-1<J.isLoadingItem.indexOf(e.id)]]),I],8,C)]),(0,l._)("td",null,(0,s.zw)(e.product.title),1),(0,l._)("td",null,[(0,l._)("div",L,[(0,l._)("div",D,[(0,l.wy)((0,l._)("select",{class:"form-select","onUpdate:modelValue":t=>e.qty=t,onChange:a=>t.updateCartItem(e),disabled:-1<J.isLoadingItem.indexOf(e.id)},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.qty,(t=>((0,l.wg)(),(0,l.iD)("option",{value:t,key:`${t}-${e.id}`},(0,s.zw)(t),9,q)))),128))],40,z),[[d.bM,e.qty]]),(0,l._)("span",V,(0,s.zw)(e.product.unit),1)])])]),(0,l._)("td",M,(0,s.zw)(e.total),1)])))),128)):(0,l.kq)("",!0)]),(0,l._)("tfoot",null,[(0,l._)("tr",null,[$,(0,l._)("td",U,(0,s.zw)(J.cartData.total),1)])])]),(0,l._)("div",W,[(0,l._)("div",O,[(0,l.Wm)(X,{ref:"form",class:"col-md-6",onSubmit:N.createOrder},{default:(0,l.w5)((({errors:t})=>[(0,l._)("div",P,[Z,(0,l.Wm)(Q,{id:"email",name:"email",type:"email",class:(0,s.C_)(["form-control",{"is-invalid":t["email"]}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:J.form.user.email,"onUpdate:modelValue":e[1]||(e[1]=t=>J.form.user.email=t)},null,8,["class","modelValue"]),(0,l.Wm)(R,{name:"email",class:"invalid-feedback"})]),(0,l._)("div",T,[F,(0,l.Wm)(Q,{id:"name",name:"姓名",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":t["姓名"]}]),placeholder:"請輸入姓名",rules:"required",modelValue:J.form.user.name,"onUpdate:modelValue":e[2]||(e[2]=t=>J.form.user.name=t)},null,8,["class","modelValue"]),(0,l.Wm)(R,{name:"姓名",class:"invalid-feedback"})]),(0,l._)("div",E,[H,(0,l.Wm)(Q,{id:"tel",name:"電話",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":t["電話"]}]),placeholder:"請輸入電話",rules:"required|min:8",modelValue:J.form.user.tel,"onUpdate:modelValue":e[3]||(e[3]=t=>J.form.user.tel=t)},null,8,["class","modelValue"]),(0,l.Wm)(R,{name:"電話",class:"invalid-feedback"})]),(0,l._)("div",Y,[j,(0,l.Wm)(Q,{id:"address",name:"地址",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":t["地址"]}]),placeholder:"請輸入地址",rules:"required",modelValue:J.form.user.address,"onUpdate:modelValue":e[4]||(e[4]=t=>J.form.user.address=t)},null,8,["class","modelValue"]),(0,l.Wm)(R,{name:"地址",class:"invalid-feedback"})]),(0,l._)("div",K,[S,(0,l.wy)((0,l._)("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[5]||(e[5]=t=>J.form.message=t)},null,512),[[d.nr,J.form.message]])]),(0,l._)("div",A,[(0,l._)("button",{type:"submit",class:"btn btn-danger",disabled:Object.keys(t).length>0||0===J.cartData.carts?.length},"送出訂單",8,B)])])),_:1},8,["onSubmit"])])]),(0,l.Wm)(tt,{id:J.productId,ref:"productModal"},null,8,["id"])],64)}var J=a(422);const N={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},Q={class:"modal-dialog modal-xl",role:"document"},R={class:"modal-content border-0"},X={class:"modal-header bg-dark text-white"},tt={class:"modal-title",id:"exampleModalLabel"},et=(0,l._)("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),at={class:"modal-body"},lt={class:"row"},st={class:"col-sm-6"},dt=["src"],it={class:"col-sm-6"},ot={class:"badge bg-primary rounded-pill"},rt={key:0,class:"h5"},nt={class:"h6"},ct={class:"h5"},ut={class:"input-group"},mt=["disabled"],pt=["disabled"];function ht(t,e,a,i,o,r){return(0,l.wg)(),(0,l.iD)("div",N,[(0,l._)("div",Q,[(0,l._)("div",R,[(0,l._)("div",X,[(0,l._)("h5",tt,[(0,l._)("span",null,(0,s.zw)(o.product.title),1)]),et]),(0,l._)("div",at,[(0,l._)("div",lt,[(0,l._)("div",st,[(0,l._)("img",{class:"img-fluid",src:o.product.imageUrl,alt:""},null,8,dt)]),(0,l._)("div",it,[(0,l._)("span",ot,(0,s.zw)(o.product.category),1),(0,l._)("p",null,"商品描述："+(0,s.zw)(o.product.content),1),(0,l._)("p",null,"商品內容："+(0,s.zw)(o.product.description),1),o.product.price===o.product.origin_price?((0,l.wg)(),(0,l.iD)("div",rt,(0,s.zw)(o.product.price)+" 元 ",1)):(0,l.kq)("",!0),(0,l._)("div",null,[(0,l._)("del",nt,"原價 "+(0,s.zw)(o.product.origin_price)+" 元",1),(0,l._)("div",ct,"現在只要 "+(0,s.zw)(o.product.price)+" 元",1)]),(0,l._)("div",null,[(0,l._)("div",ut,[(0,l.wy)((0,l._)("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":e[0]||(e[0]=t=>o.qty=t),disabled:o.isLoading},null,8,mt),[[d.nr,o.qty]]),(0,l._)("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=(...t)=>r.addToCart&&r.addToCart(...t)),disabled:o.isLoading},"加入購物車",8,pt)])])])])])])])],512)}var bt=a(7972),gt=a.n(bt),_t={props:["id"],data(){return{modal:{},product:{},qty:1,isLoading:!1,preId:""}},watch:{id(){this.getProduct(),this.preId!==this.id&&(this.preId=this.id,this.product={})}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},getProduct(){this.isLoading=!0,this.$http.get(`https://vue3-course-api.hexschool.io/v2/api/202201-vue-shaoyu/product/${this.id}`).then((t=>{this.product=t.data.product,this.isLoading=!1}))},addToCart(){this.product&&this.product.id&&(J.Z.emit("add-cart",{id:this.product.id,qty:this.qty}),this.closeModal())}},mounted(){this.modal=new(gt())(this.$refs.modal,{keyboard:!1,backdrop:"static"})}},vt=a(89);const ft=(0,vt.Z)(_t,[["render",ht]]);var yt=ft,wt={data(){return{cartData:{},products:[],productId:"",isLoadingItem:[],form:{user:{name:"",email:"",tel:"",address:""},message:""}}},components:{ProductModal:yt},methods:{getProducts(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/202201-vue-shaoyu/products/all").then((t=>{this.products=t.data.products}))},openProductModal(t){this.productId=t,this.$refs.productModal.openModal()},getCart(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/202201-vue-shaoyu/cart").then((t=>{this.cartData=t.data.data,J.Z.emit("get-cart")}))},addToCart(t,e=1){this.isLoadingItem.push(t);const a={product_id:t,qty:e};this.$http.post("https://vue3-course-api.hexschool.io/v2/api/202201-vue-shaoyu/cart",{data:a}).then((()=>{this.getCart(),this.isLoadingItem=[]}))},clearCart(){const t=[];this.cartData.carts&&(this.cartData.carts.forEach((e=>{t.push(e.id)})),t.length<=0||(this.isLoadingItem=[...t],this.$http.delete("https://vue3-course-api.hexschool.io/v2/api/202201-vue-shaoyu/carts").then((()=>{this.isLoadingItem=[],this.getCart()}))))},removeCartItem(t){this.isLoadingItem=[t],this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/202201-vue-shaoyu/cart/${t}`).then((()=>{this.getCart(),this.isLoadingItem=[]}))},createOrder(){const t=this.form;this.$http.post("https://vue3-course-api.hexschool.io/v2/api/202201-vue-shaoyu/order",{data:t}).then((t=>{J.Z.emit("push-message",{style:"success",title:"送出訂單成功",content:t.data.message}),this.$refs.form.resetForm(),this.getCart()})).catch((t=>{J.Z.emit("push-message",{style:"danger",title:"錯誤訊息",content:t.data.message})}))}},mounted(){this.getProducts(),this.getCart(),J.Z.on("add-cart",(t=>{this.addToCart(t.id,t.qty)}))}};const kt=(0,vt.Z)(wt,[["render",G]]);var Ct=kt}}]);
//# sourceMappingURL=869.4be2afad.js.map